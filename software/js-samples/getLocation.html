<!DOCTYPE html><html lang=en><head><meta charset=utf-8><title>Geotab SDK | Get Device Location Example</title><link rel=icon href=../../favicon.ico><link href=js/leaflet/leaflet.css rel=stylesheet type=text/css><link href=css/JavaScriptExamples.css rel=stylesheet type=text/css><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet></head><body><header><nav><a href=https://geotab.github.io/sdk/software/introduction/ target=_blank><img src=../../assets/images/pillar.svg width=35 height=35 alt=""><h1>MyGeotab SDK</h1></a><div class=sample-tooltip><h1>DEVELOPER SAMPLE</h1><div class=sample-tooltip-text><p>This tool is provided as an example and is available on an As-Is basis. You must assume all the risks and costs associated with the use of the sample tool, including, without limitation, any damage to any equipment, software, information or data. In addition, we are not obligated to provide any maintenance, technical or other support for the sample tool. In order to improve our products, we may at any time, and without warning, change the design, presentation, or functionality of the software.</p></div></div><button class="primary-btn sign-out-btn" id=signout>Sign out</button></nav></header><div class=container><div id=signin-content></div><div class=example-header><div class=title>Get Device Location Example</div><div class=skill-level>Skill level:<div class=skill-tooltip><img src=images/intermediate-pill.svg><div class=skill-text><p>This example demonstrates a tool that can be built with an intermediate-level knowledge of the MyGeotab system. It is suitable for those who have a good understanding of the Geotab ecosystem and are comfortable with the MyGeotab SDK and leveraging the MyGeotab APIs within their projects.</p></div></div></div><div class=description>This example makes two API requests for the vehicle and location and displays it on a map. To retrieve the current location of a vehicle, we first look up the vehicle by its serial number. When the API response returns our vehicle properties, we use that responses callback to retrieve the DeviceStatusInfo object which contains the current location. With this data, a location marker is added to the map.</div><div class=api-references>In this example<details open><summary>API Methods:</summary><a href=https://geotab.github.io/sdk/software/api/reference/#Get1 target=_blank>Get</a></details><details open><summary>API Entities:</summary><a href=https://geotab.github.io/sdk/software/api/reference/#Device target=_blank>Device</a> <a href=https://geotab.github.io/sdk/software/api/reference/#DeviceStatusInfo target=_blank>DeviceStatusInfo</a></details></div></div><div id=example-content><form><p><label for=deviceSerial>Serial number</label> <input id=deviceSerial placeholder="Example: G5-xxx-xxx-xxxx"></p><button class=primary-btn id=search>Search</button></form></div><div class=map-container><div id=map></div></div></div><script src=js/leaflet/leaflet.js></script><script src=js/api.js></script><script src=js/login.js></script><script type=text/javascript>var map;
            var layerGroup;

            document.addEventListener("DOMContentLoaded", function () {
                // Set up Leaflet map (https://leafletjs.com)
                map = new L.Map("map").setView([43.437111,-79.712756], 13);
                L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                    subdomains: ['a','b','c']
                }).addTo(map);
                layerGroup = L.layerGroup().addTo(map);

                document.getElementById("search").addEventListener("click", function (event) {
                    event.preventDefault();

                    var deviceSerial = document.getElementById("deviceSerial").value;

                    // Use Geotab API to search by serial number
                    if (deviceSerial == "") {
                        alert("Serial number is required");
                    } else {
                        api.call("Get", {
                            typeName: "Device",
                            search: {
                                serialNumber: deviceSerial
                            }
                        }, function (result) {
                            if (result.length > 0) {
                                showDeviceLocation(result[0]);
                            } else {
                                alert("Could not find a device for that serial number");
                            }
                        }, function (error) {
                            alert(error);
                        });
                    }
                });
            });

            // Retrieves the current location of a device and displays it on Leaflet
            function showDeviceLocation(device) {
                api.call("Get", {
                    typeName: "DeviceStatusInfo",
                    search: {
                        deviceSearch: {
                            id: device.id
                        }
                    }
                }, function (result) {
                    if (result.length > 0) {
                        var location = new L.LatLng(result[0].latitude, result[0].longitude);
                        var marker = L.marker(location).bindPopup(
                            "<strong>" + device.name + "</strong><br />" +
                            location.lat + ", " + location.lng);
                            
                        layerGroup.clearLayers().addLayer(marker);
                        map.setView(location, 15);
                    } else {
                        alert("Location information not available for the inputted device")
                    }
                }, function (error) {
                    alert(error);
                });
            }</script></body></html>